"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[41115],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,h=d["".concat(p,".").concat(m)]||d[m]||u[m]||r;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},29604:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>c});n(67294);var o=n(3905);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a.apply(this,arguments)}function r(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={title:"It's Not Dead: webpack and dead code elimination limitations",authors:"johnnyreilly",tags:["webpack"],hide_table_of_contents:!1},l=void 0,p={permalink:"/2018/03/07/its-not-dead-webpack-and-dead-code",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2018-03-07-its-not-dead-webpack-and-dead-code/index.md",source:"@site/blog/2018-03-07-its-not-dead-webpack-and-dead-code/index.md",title:"It's Not Dead: webpack and dead code elimination limitations",description:"Webpack has long supported the notion of dead code elimination. webpack facilitates this through use of the DefinePlugin. The compile time value of process.env.NODE_ENV is set either to 'production' or something else. If it's set to 'production' then some dead code hackery can happen. Libraries like React make use of this to serve up different, and crucially smaller, production builds.",date:"2018-03-07T00:00:00.000Z",formattedDate:"March 7, 2018",tags:[{label:"webpack",permalink:"/tags/webpack"}],readingTime:2.12,hasTruncateMarker:!1,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly"}],frontMatter:{title:"It's Not Dead: webpack and dead code elimination limitations",authors:"johnnyreilly",tags:["webpack"],hide_table_of_contents:!1},prevItem:{title:"Uploading Images to Cloudinary with the Fetch API",permalink:"/2018/03/25/uploading-images-to-cloudinary-with-fetch"},nextItem:{title:"ts-loader 4 / fork-ts-checker-webpack-plugin 0.4",permalink:"/2018/02/25/ts-loader-400-fork-ts-checker-webpack"}},s={authorsImageUrls:[void 0]},c=[{value:"Limitations",id:"limitations",level:2}],d={toc:c};function u(e){var{components:t}=e,n=r(e,["components"]);return(0,o.kt)("wrapper",a({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Webpack has long supported the notion of dead code elimination. webpack facilitates this through use of the ",(0,o.kt)("inlineCode",{parentName:"p"},"DefinePlugin"),". The compile time value of ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV")," is set either to ",(0,o.kt)("inlineCode",{parentName:"p"},"'production'")," or something else. If it's set to ",(0,o.kt)("inlineCode",{parentName:"p"},"'production'")," then some dead code hackery can happen. ",(0,o.kt)("a",a({parentName:"p"},{href:"https://reactjs.org/docs/optimizing-performance.html#webpack"}),"Libraries like React make use of this to serve up different, and crucially smaller, production builds.")),(0,o.kt)("p",null,"Every now and then you can be surprised. Your assumptions turn out to be wrong."),(0,o.kt)("p",null,"A (pre-webpack 4) production config file will typically contain this code:"),(0,o.kt)("pre",null,(0,o.kt)("code",a({parentName:"pre"},{className:"language-js"}),"new webpack.DefinePlugin({\n    'process.env.NODE_ENV': JSON.stringify('production')\n}),\nnew UglifyJSPlugin(),\n")),(0,o.kt)("p",null,"The result of the above config is that webpack will inject the value 'production' everywhere in the codebase where a ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV")," can be found. (In fact, as of webpack 4 setting this magic value is out-of-the-box behaviour for Production mode; yay the #0CJS!)"),(0,o.kt)("p",null,"What this means is, if you've written:"),(0,o.kt)("pre",null,(0,o.kt)("code",a({parentName:"pre"},{className:"language-js"}),"if (process.env.NODE_ENV !== 'production') {\n  // Do a development mode only thing\n}\n")),(0,o.kt)("p",null,"webpack can and will turn this into"),(0,o.kt)("pre",null,(0,o.kt)("code",a({parentName:"pre"},{className:"language-js"}),"if ('production' !== 'production') {\n  // Do a development mode only thing\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("a",a({parentName:"p"},{href:"https://github.com/webpack-contrib/uglifyjs-webpack-plugin"}),"UglifyJSPlugin")," is there to minify the JavaScript in your bundles. As an added benefit, this plugin is smart enough to know that ",(0,o.kt)("inlineCode",{parentName:"p"},"'production' !== 'production'")," is always ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),". And because it's smart, it chops the code. Dead code elimated."),(0,o.kt)("p",null,"You can read more about this ",(0,o.kt)("a",a({parentName:"p"},{href:"https://webpack.js.org/guides/production/#specify-the-environment"}),"in the webpack docs"),"."),(0,o.kt)("h2",a({},{id:"limitations"}),"Limitations"),(0,o.kt)("p",null,"Given what I've said, consider the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",a({parentName:"pre"},{className:"language-js"}),"export class Config {\n  // Other properties\n\n  get isDevelopment() {\n    return process.env.NODE_ENV !== 'production';\n  }\n}\n")),(0,o.kt)("p",null,"This is a config class that exposes the expression ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV !== 'production'")," with the friendly name ",(0,o.kt)("inlineCode",{parentName:"p"},"isDevelopment"),". You'd think that dead code elimination would be your friend here. It's not."),(0,o.kt)("p",null,"My personal expection was that dead code elimination would treat ",(0,o.kt)("inlineCode",{parentName:"p"},"Config.isDevelopment")," and the expression ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV !== 'production'")," identically. Because they're identical."),(0,o.kt)("p",null,"However, this turns out not to be the case. Dead code elimination works just as you would hope when using the expression ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV !== 'production'")," directly in code. However webpack ",(0,o.kt)("strong",{parentName:"p"},"only")," performs dead code elimination for the ",(0,o.kt)("strong",{parentName:"p"},"direct")," usage of the ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV !== 'production'")," expression. I'll say that again: if you want dead code elimination then use the injected values; not an encapsulated version of them. It turns out you cannot rely on webpack flowing values through and performing dead code elimination on that basis."),(0,o.kt)("p",null,"The TL;DR: if you want to elimate dead code then ","*","always","*"," use ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV !== 'production'"),"; don't abstract it. It doesn't work."),(0,o.kt)("p",null,"UglifyJS is smart. But not that smart."))}u.isMDXComponent=!0}}]);