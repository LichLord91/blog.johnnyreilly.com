<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=297675200"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","297675200",{})</script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">Snapshot Testing for C# | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/2018/11/17/snapshot-testing-for-c"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="max-image-preview:large"><meta data-react-helmet="true" property="og:title" content="Snapshot Testing for C# | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="If you&#x27;re a user of Jest, you&#x27;ve no doubt heard of and perhaps made use of snapshot testing."><meta data-react-helmet="true" property="og:description" content="If you&#x27;re a user of Jest, you&#x27;ve no doubt heard of and perhaps made use of snapshot testing."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2018-11-17T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://twitter.com/johnny_reilly"><meta data-react-helmet="true" property="article:tag" content="snapshot testing,c#,jest"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/2018/11/17/snapshot-testing-for-c"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2018/11/17/snapshot-testing-for-c" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2018/11/17/snapshot-testing-for-c" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.85320736.css">
<link rel="preload" href="/assets/js/runtime~main.1ebfb004.js" as="script">
<link rel="preload" href="/assets/js/main.398291a3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/27/azure-container-apps-build-and-deploy-with-bicep-and-github-actions">Azure Container Apps: build and deploy with Bicep and GitHub Actions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/19/azure-container-apps-bicep-and-github-actions">Azure Container Apps, Bicep and GitHub Actions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/12/open-graph-sharing-previews-guide">Open Graph: a guide to sharable social media previews</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/05/azure-static-web-app-deploy-previews-with-azure-devops">Azure Static Web App Deploy Previews with Azure DevOps</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/11/22/typescript-vs-jsdoc-javascript">TypeScript vs JSDoc JavaScript</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Snapshot Testing for C#</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2018-11-17T00:00:00.000Z" itemprop="datePublished">November 17, 2018</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>If you&#x27;re a user of Jest, you&#x27;ve no doubt heard of and perhaps made use of <a href="https://jestjs.io/docs/en/snapshot-testing" target="_blank" rel="noopener noreferrer">snapshot testing</a>.</p><p>Snapshot testing is an awesome tool that is generally discussed in the context of JavaScript React UI testing. But snapshot testing has a wider application than that. Essentially it is profoundly useful where you have functions which produce a complex structured output. It could be a React UI, it could be a list of FX prices. The type of data is immaterial; it&#x27;s the amount of it that&#x27;s key.</p><p>Typically there&#x27;s a direct correlation between the size and complexity of the output of a method and the length of the tests that will be written for it. Let&#x27;s say you&#x27;re outputting a class that contains 20 properties. Congratulations! You get to write 20 assertions in one form or another for each test case. Or a single assertion whereby you supply the expected output by hand specifying each of the 20 properties. Either way, that&#x27;s not going to be fun. And just imagine the time it would take to update multiple test cases if you wanted to change the behaviour of the method in question. Ouchy.</p><p>Time is money kid. What you need is snapshot testing. Say goodbye to handcrafted assertions and hello to JSON serialised output checked into source control. Let&#x27;s unpack that a little bit. The usefulness of snapshot testing that I want in C# is predominantly about removing the need to write and maintain multiple assertions. Instead you write tests that compare the output of a call to your method with JSON serialised output you&#x27;ve generated on a previous occasion.</p><p>This approach takes less time to write, less time to maintain and the solid readability of JSON makes it more likely you&#x27;ll pick up on bugs. It&#x27;s so much easier to scan JSON than it is a list of assertions.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="putting-the-snapshot-into-c">Putting the Snapshot into C#<a class="hash-link" href="#putting-the-snapshot-into-c" title="Direct link to heading">â€‹</a></h2><p>Now if you&#x27;re writing tests in JavaScript or TypeScript then Jest already has your back with CLI snapshot generation and <code>shouldMatchSnapshot</code>. However getting to nearly the same place in C# is delightfully easy. What are we going to need?</p><p>First up, a serializer which can take your big bad data structures and render them as JSON. Also we&#x27;ll use it to rehydrate our data structure into an object ready for comparison. We&#x27;re going to use <a href="https://www.newtonsoft.com/json" target="_blank" rel="noopener noreferrer">Json.NET</a>.</p><p>Next up we need a way to compare our outputs with our rehydrated snapshots - we need a C# <code>shouldMatchSnapshot</code>. There&#x27;s many choices out there, but for my money <a href="https://fluentassertions.com" target="_blank" rel="noopener noreferrer">Fluent Assertions</a> is king of the hill.</p><p>Finally we&#x27;re going to need Snapshot, a little helper utility I put together:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">using System.IO;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">using Newtonsoft.Json;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">using Newtonsoft.Json.Serialization;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">namespace Test.Utilities {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    public static class Snapshot {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        private static readonly JsonSerializer StubSerializer = new JsonSerializer {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ContractResolver = new CamelCasePropertyNamesContractResolver(),</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            NullValueHandling = NullValueHandling.Ignore</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        private static JsonTextWriter MakeJsonTextWriter(TextWriter sw) =&gt; new JsonTextWriter(sw) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            Formatting = Formatting.Indented,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            IndentChar = &#x27; &#x27;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            Indentation = 2</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        /// Make yourself some JSON! Usage looks like this:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        /// Stubs.Make($&quot;{System.AppDomain.CurrentDomain.BaseDirectory}..\\..\\..\\data.json&quot;, myData);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        public static void Make&lt;T&gt;(string stubPath, T data) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                if (string.IsNullOrEmpty(stubPath))</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                    throw new ArgumentNullException(nameof(stubPath));</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                if (data == null)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                    throw new ArgumentNullException(nameof(data));</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                using(var sw = new StreamWriter(stubPath))</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                using(var writer = MakeJsonTextWriter(sw)) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                    StubSerializer.Serialize(writer, data);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            } catch (Exception exc) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                throw new Exception($&quot;Failed to make {stubPath}&quot;, exc);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        public static string Serialize&lt;T&gt;(T data) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            using (var sw = new StringWriter())</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            using(var writer = MakeJsonTextWriter(sw)) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                StubSerializer.Serialize(writer, data);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                return sw.ToString();</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        public static string Load(string filename) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            var content = new StreamReader(</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                File.OpenRead(filename)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ).ReadToEnd();</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            return content;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s look at the methods: <code>Make</code> and <code>Load</code>. Make is what we&#x27;re going to use to create our snapshots. Load is what we&#x27;re going to use to, uh, load our snapshots.</p><p>What does usage look like? Great question. Let&#x27;s go through the process of writing a C# snapshot test.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="taking-snapshot-for-a-spin">Taking Snapshot for a Spin<a class="hash-link" href="#taking-snapshot-for-a-spin" title="Direct link to heading">â€‹</a></h2><p>First of all, we&#x27;re going to need a method to test that outputs a data structure which is more than just a scalar value. Let&#x27;s use this:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token plain">public class Leopard {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    public string Name { get; set; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    public int Spots { get; set; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">public class LeopardService {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    public Leopard[] GetTheLeopards() {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        return new Leopard[] {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            new Leopard { Spots = 42, Name = &quot;Nimoy&quot; },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            new Leopard { Spots = 900, Name = &quot;Dotty&quot; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Yes - our trusty <code>LeopardService</code>. As you can see, the <code>GetTheLeopards</code> method returns an array of <code>Leopard</code>s. For now, let&#x27;s write a test using <code>Snapshot</code>: (ours is an XUnit test; but <code>Snapshot</code> is agnostic of this)</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token plain">[Fact]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">public void GetTheLeopards_should_return_expected_Leopards() {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    // Arrange</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    var leopardService = new LeopardService();</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    // Act</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    var leopards = leopardService.GetTheLeopards();</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    // UNCOMMENT THE LINE BELOW *ONLY* WHEN YOU WANT TO GENERATE THE SNAPSHOT</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Snapshot.Make($&quot;{System.AppDomain.CurrentDomain.BaseDirectory}..\\..\\..\\Snapshots\\leopardsSnapshot.json&quot;, leopards);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    // Assert</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    var snapshotLeopards = JsonConvert.DeserializeObject&lt;leopard[]&gt;(Snapshot.Load(&quot;Snapshots/leopardsSnapshot.json&quot;));</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    snapshotLeopards.Should().BeEquivalentTo(leopards);</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/leopard[]&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Before we run this for the first time we need to setup our testing project to be ready for snapshots. First of all we add a <code>Snapshot</code> folder to the test project. The we also add the following to the <code>.csproj</code>:</p><div class="codeBlockContainer_J+bg language-xml theme-code-block"><div class="codeBlockContent_csEI xml"><pre tabindex="0" class="prism-code language-xml codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">ItemGroup</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Content</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Include</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">Snapshots\**</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">CopyToOutputDirectory</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Always</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">CopyToOutputDirectory</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">Content</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">ItemGroup</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This includes the snapshots in the compile output for when tests are being run.</p><p>Now let&#x27;s run the test. It will generate a <code>leopardsSnapshot.json</code> file:</p><div class="codeBlockContainer_J+bg language-json theme-code-block"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Nimoy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;spots&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Dotty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;spots&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">900</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With our snapshot in place, we comment out the <code>Snapshot.Make...</code> line and we have a passing test. Let&#x27;s commit our code, push and go about our business.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="time-passes">Time Passes...<a class="hash-link" href="#time-passes" title="Direct link to heading">â€‹</a></h2><p>Someone decides that the implementation of <code>GetTheLeopards</code> needs to change. Defying expectations it seems that Dotty the leopard should now have 90 spots. I know... Business requirements, right?</p><p>If we make that change we&#x27;d ideally expect our trusty test to fail. Let&#x27;s see what happens:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token plain">----- Test Execution Summary -----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Leopard.Tests.Services.LeopardServiceTests.GetTheLeopards_should_return_expected_Leopards:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Outcome: Failed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Error Message:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Expected item[1].Spots to be 90, but found 900.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Boom! We are protected!</p><p>Since this is a change we&#x27;re completely happy with we want to update our <code>leopardsSnapshot.json</code> file. We could make our test pass by manually updating the JSON. That&#x27;d be fine. But why work when you don&#x27;t have to? Let&#x27;s uncomment our <code>Snapshot.Make...</code> line and run the test the once.</p><div class="codeBlockContainer_J+bg language-json theme-code-block"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Nimoy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;spots&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Dotty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;spots&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">90</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>That&#x27;s right, we have an updated snapshot! Minimal effort.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="next-steps">Next Steps<a class="hash-link" href="#next-steps" title="Direct link to heading">â€‹</a></h2><p>This is a basic approach to getting the goodness of snapshot testing in C#. It could be refined further. To my mind the uncommenting / commenting of code is not the most elegant way to approach this and so there&#x27;s some work that could be done around this area.</p><p>Happy snapshotting!</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/snapshot-testing">snapshot testing</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/c">c#</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/jest">jest</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/blog/2018-11-17-snapshot-testing-for-c/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2018/12/10/cache-rules-everything-around-me"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Cache Rules Everything Around Me</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2018/10/27/making-a-programmer"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Making a Programmer<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#putting-the-snapshot-into-c" class="table-of-contents__link toc-highlight">Putting the Snapshot into C#</a></li><li><a href="#taking-snapshot-for-a-spin" class="table-of-contents__link toc-highlight">Taking Snapshot for a Spin</a></li><li><a href="#time-passes" class="table-of-contents__link toc-highlight">Time Passes...</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1ebfb004.js"></script>
<script src="/assets/js/main.398291a3.js"></script>
</body>
</html>