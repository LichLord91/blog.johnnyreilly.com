<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=297675200"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","297675200",{})</script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">2 posts tagged with &quot;TFS 2012&quot; | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="2 posts tagged with &quot;TFS 2012&quot; | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/tags/tfs-2012"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" name="robots" content="max-image-preview:large"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/tfs-2012"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/tfs-2012" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/tfs-2012" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.85320736.css">
<link rel="preload" href="/assets/js/runtime~main.a087a053.js" as="script">
<link rel="preload" href="/assets/js/main.e22f0193.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/29/preload-fonts-with-docusaurus">Preload fonts with Docusaurus</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/28/azure-cli-show-query-output-properties">Query deployment outputs with the Azure CLI</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/27/azure-container-apps-build-and-deploy-with-bicep-and-github-actions">Azure Container Apps: build and deploy with Bicep and GitHub Actions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/19/azure-container-apps-bicep-and-github-actions">Azure Container Apps, Bicep and GitHub Actions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/2021/12/12/open-graph-sharing-previews-guide">Open Graph: a guide to sharable social media previews</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;TFS 2012&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/2016/03/04/tfs-2012-meet-powershell-karma-and-buildnumber">TFS 2012 meet PowerShell, Karma and BuildNumber</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2016-03-04T00:00:00.000Z" itemprop="datePublished">March 4, 2016</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>To my lasting regret, TFS 2012 has no direct support for PowerShell. Such a shame as PowerShell scripts can do a lot of heavy lifting in a build process. Well, here we&#x27;re going to brute force TFS 2012 into running PowerShell scripts. And along the way we&#x27;ll also get Karma test results publishing into TFS 2012 as an example usage. Nice huh? Let&#x27;s go!</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="powershell-via-csproj">PowerShell via <code>csproj</code><a class="hash-link" href="#powershell-via-csproj" title="Direct link to heading">â€‹</a></h2><p>It&#x27;s time to hack the <code>csproj</code> (or whatever project file you have) again. We&#x27;re going to add an <code>AfterBuild</code> target to the end of the file. This target will be triggered after the build completes (as the name suggests):</p><div class="codeBlockContainer_J+bg language-xml theme-code-block"><div class="codeBlockContent_csEI xml"><pre tabindex="0" class="prism-code language-xml codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Target</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">AfterBuild</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Message</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Importance</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">High</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Text</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">AfterBuild: PublishUrl = $(PublishUrl), BuildUri = $(BuildUri), Configuration = $(Configuration), ProjectDir = $(ProjectDir), TargetDir = $(TargetDir), TargetFileName = $(TargetFileName), BuildNumber = $(BuildNumber), BuildDefinitionName = $(BuildDefinitionName)</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Exec</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Command</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">powershell.exe -NonInteractive -ExecutionPolicy RemoteSigned </span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&amp;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(ProjectDir)AfterBuild.ps1&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(Configuration)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(ProjectDir)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(TargetDir)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(PublishUrl)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(BuildNumber)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(BuildDefinitionName)&#x27;&quot;&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">Target</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>There&#x27;s 2 things happening in this target:</p><ol><li>A message is printed out during compilation which contains details of the various compile time variables. This is nothing more than a <code>console.log</code> statement really; it&#x27;s useful for debugging and so I keep it around. You&#x27;ll notice one of them is called <code>$(BuildNumber)</code>; more on that later.</li><li>A command is executed; PowerShell! This invokes PowerShell with the <code>-NonInteractive</code> and <code>-ExecutionPolicy RemoteSigned</code> flags. It passes a script to be executed called <code>AfterBuild.ps1</code> that lives in the root of the project directory. To that script a number of parameters are supplied; compile time variables that we may use in the script.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="wheres-my-buildnumber-and-builddefinitionname">Where&#x27;s my <code>BuildNumber</code> and <code>BuildDefinitionName</code>?<a class="hash-link" href="#wheres-my-buildnumber-and-builddefinitionname" title="Direct link to heading">â€‹</a></h2><p>So you&#x27;ve checked in your changes and kicked off a build on the server. You&#x27;re picking over the log messages and you&#x27;re thinking: &quot;Where&#x27;s my <code>BuildNumber</code>?&quot;. Well, TFS 2012 does not have that set as a variable at compile time by default. This stumped me for a while but thankfully I wasn&#x27;t the only person wondering... As ever, <a href="http://stackoverflow.com/a/7330453/761388" target="_blank" rel="noopener noreferrer">Stack Overflow had the answer</a>. So, deep breath, it&#x27;s time to hack the TFS build template file.</p><p>Checkout the <code>DefaultTemplate.11.1.xaml</code> file from TFS and open it in your text editor of choice. It&#x27;s <em>find and replace</em> time! (There are probably 2 instances that need replacement.) Perform a <em>find</em> for the below</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And <em>replace</em> it with this:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/p:SkipInvalidConfigurations=true /p:BuildNumber={1} /p:BuildDefinitionName={2} {0}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Pretty long line eh? Let&#x27;s try breaking that up to make it more readable: (but remember in the XAML it needs to be a one liner)</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">BuildNumber</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">BuildDefinitionName</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We&#x27;re just adding 2 extra parameters of <code>BuildNumber</code> and <code>BuildDefinitionName</code> to the invocation of MSBuild. Once we&#x27;ve checked this back in, <code>BuildNumber</code> and <code>BuildDefinitionName</code> will be available on future builds. Yay! <em>Important! You must have a build name that does not feature spaces; probably there&#x27;s a way to pass spaces here but I&#x27;m not sure what it is.</em></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="afterbuildps1"><code>AfterBuild.ps1</code><a class="hash-link" href="#afterbuildps1" title="Direct link to heading">â€‹</a></h2><p>You can use your <code>AfterBuild.ps1</code> script to do any number of things. In my case I&#x27;m going to use MSTest to publish some test results which have been generated by Karma into TFS:</p><div class="codeBlockContainer_J+bg language-ps theme-code-block"><div class="codeBlockContent_csEI ps"><pre tabindex="0" class="prism-code language-ps codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token plain">param ([string]$configuration, [string]$projectDir, [string]$targetDir, [string]$publishUrl, [string]$buildNumber, [string] $buildDefinitionName)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$ErrorActionPreference = &#x27;Stop&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Clear</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function PublishTestResults([string]$resultsFile) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &#x27;PublishTests&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $mstest = &#x27;C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &quot;Using $mstest at $pwd&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &quot;Publishing: $resultsFile&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> &amp; $mstest /publishresultsfile:$resultsFile /publish:http://my-tfs-server:8080/tfs /teamproject:MyProject /publishbuild:$buildNumber /platform:&#x27;Any CPU&#x27; /flavor:Release</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function FailBuildIfThereAreTestFailures([string]$resultsFile) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $results = [xml](GC $resultsFile)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $outcome = $results.TestRun.ResultSummary.outcome</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $fgColor = if($outcome -eq &quot;Failed&quot;) { &quot;Red&quot; } else { &quot;Green&quot; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $total = $results.TestRun.ResultSummary.Counters.total</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $passed = $results.TestRun.ResultSummary.Counters.passed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failed = $results.TestRun.ResultSummary.Counters.failed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failedTests = $results.TestRun.Results.UnitTestResult | Where-Object { $_.outcome -eq &quot;Failed&quot; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Test Results: $outcome -ForegroundColor $fgColor -BackgroundColor &quot;Black&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Total tests: $total</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Passed: $passed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Failed: $failed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failedTests | % { Write-Host Failed test: $_.testName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host $_.Output.ErrorInfo.Message</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host $_.Output.ErrorInfo.StackTrace }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> if($outcome -eq &quot;Failed&quot;) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host &quot;Failing build as there are broken tests&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  $host.SetShouldExit(1)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function Run() {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host &quot;Running AfterBuild.ps1 using Configuration: $configuration, projectDir: $projectDir, targetDir: $targetDir, publishUrl: $publishUrl, buildNumber: $buildNumber, buildDefinitionName: $buildDefinitionName&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> if($buildNumber) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  $resultsFile = &quot;$projectDir\test-results.trx&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  PublishTestResults $resultsFile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  FailBuildIfThereAreTestFailures $resultsFile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Off we go...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Assuming we have a build number this script kicks off the <code>PublishTestResults</code> function above. So we won&#x27;t attempt to publish test results when compiling in Visual Studio on our dev machine. The script looks for <code>MSTest.exe</code> in a certain location on disk (the default VS 2015 installation location in fact; it may be installed elsewhere on your build machine). MSTest is then invoked and passed a file called <code>test-results.trx</code> which is is expected to live in the root of the project. All being well, the test results will be registered with the running build and will be visible when you look at test results in TFS.</p><p>Finally in <code>FailBuildIfThereAreTestFailures</code> we parse the <code>test-results.trx</code> file (and for this I&#x27;m totally in the debt of <a href="https://gist.github.com/davidroberts63/5655441" target="_blank" rel="noopener noreferrer">David Robert&#x27;s helpful Gist</a>). We write out the results to the host so it&#x27;ll show up in the MSBuild logs. Also, and this is crucial, if there are any failures we fail the build by exiting PowerShell with a code of 1. We are deliberately swallowing any error that Karma raises earlier when it detects failed tests. We do this because we want to publish the failed test results to TFS <em>before</em> we kill the build.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="bonus-karma-test-resultstrx">Bonus Karma: <code>test-results.trx</code><a class="hash-link" href="#bonus-karma-test-resultstrx" title="Direct link to heading">â€‹</a></h2><p>If you&#x27;ve read a <a href="https://blog.johnnyreilly.com/2016/02/visual-studio-tsconfigjson-and-external.html" target="_blank" rel="noopener noreferrer">previous post of mine</a> you&#x27;ll be aware that it&#x27;s possible to get MSBuild to kick off npm build tasks. Specifically I have MSBuild kicking off an <code>npm run build</code>. My <code>package.json</code> looks like this:</p><div class="codeBlockContainer_J+bg language-json theme-code-block"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#d6deeb"><span class="token property" style="color:rgb(128, 203, 196)">&quot;scripts&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;test&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;karma start --reporters mocha,trx --single-run --browsers PhantomJS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;clean&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp delete-dist-contents&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;watch&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp watch&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;build&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp build&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;postbuild&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;npm run test&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can see that the <code>postbuild</code> hook kicks off the <code>test</code> script in turn. And that <code>test</code> script kicks off a single run of karma. I&#x27;m not going to go over setting up Karma at all here; there are other posts out there that cover that admirably. But I wanted to share news of the <a href="https://www.npmjs.com/package/karma-trx-reporter" target="_blank" rel="noopener noreferrer">karma trx reporter</a>. This reporter is the thing that produces our <code>test-results.trx</code> file; trx being the format that TFS likes to deal with.</p><p>So now we&#x27;ve got a PowerShell hook into our build process (something very useful in itself) which we are using to publish Karma test results into TFS 2012. They said it couldn&#x27;t be done. They were wrong. Huzzah!!!!!!!</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/build-definition-name">BuildDefinitionName</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/build-number">BuildNumber</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/npm">npm</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/karma">Karma</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/powershell">powershell</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/trx">trx</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/tfs-2012">TFS 2012</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about TFS 2012 meet PowerShell, Karma and BuildNumber" href="/2016/03/04/tfs-2012-meet-powershell-karma-and-buildnumber"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/2016/02/01/tfs-2012-net-45-and-c-6">TFS 2012, .NET 4.5 and C# 6</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2016-02-01T00:00:00.000Z" itemprop="datePublished">February 1, 2016</time> Â· <!-- -->One min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>So, you want to use C# 6 language features and youâ€™re working on an older project thatâ€™s still rocking .NET 4.5. Well, with <a href="http://stackoverflow.com/a/28921749/761388" target="_blank" rel="noopener noreferrer">some caveats</a>, you can.</p><p>The new compiler will compile targeting older framework versions. Well thatâ€™s all lovely; letâ€™s all go home.</p><p>Now. What say youâ€™ve got an old, old build server? Itâ€™s TFS 2012 Update 2, creaking away, still glad to alive and kind of wondering why it hasnâ€™t been upgraded or retired. This is where you want to compile .NET 4.5 from C# 6. Well it can be done. Hereâ€™s how itâ€™s done:</p><ol><li><p>Install Visual Studio 2015 on the build server (Iâ€™m told this can be achieved using <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159" target="_blank" rel="noopener noreferrer">Microsoft Build Tools 2015</a> but I havenâ€™t tried it myelf so caveat emptor)</p></li><li><p>set the <code>MSBuild Arguments</code> in the build definition to <code>/p:VisualStudioVersion=14.0</code> (i.e. Visual Studio 2015 mode) <img src="/assets/images/EditBuildConfiguration-02ee84f7299e95e7a6ddac935157a8ac.png"></p></li><li><p>in each project that uses C# 6 syntax, install the NuGet package <a href="https://www.nuget.org/packages/Microsoft.Net.Compilers" target="_blank" rel="noopener noreferrer">Microsoft.Net.Compilers</a> with a quick <code>install-package Microsoft.Net.Compilers</code></p></li></ol><p>Thatâ€™s it; huzzah! String interpolation here I comeâ€¦</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/c-6">C# 6</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/net-4-5">.Net 4.5</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/tfs-2012">TFS 2012</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about TFS 2012, .NET 4.5 and C# 6" href="/2016/02/01/tfs-2012-net-45-and-c-6"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a087a053.js"></script>
<script src="/assets/js/main.e22f0193.js"></script>
</body>
</html>