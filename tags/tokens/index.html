<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-226F0LR9KE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-226F0LR9KE",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="I CAN MAKE THIS WORK" href="/opensearch.xml">
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-rh="true">One post tagged with &quot;tokens&quot; | I CAN MAKE THIS WORK</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-rh="true" property="og:url" content="https://blog.johnnyreilly.com/tags/tokens"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" property="og:title" content="One post tagged with &quot;tokens&quot; | I CAN MAKE THIS WORK"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/tokens"><link data-rh="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/tokens" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/tokens" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://J3MYR1INLT-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.ccaeaa27.css">
<link rel="preload" href="/assets/js/runtime~main.307037d0.js" as="script">
<link rel="preload" href="/assets/js/main.72483867.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/04/06/eslint-your-csharp-in-vs-code-with-roslyn-analyzers">ESLint your C# in VS Code with Roslyn Analyzers</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/03/30/azure-devops-consume-private-nuget-artifact-feed">Azure DevOps: consume a private artifact feed</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/03/20/lighthouse-meet-github-actions">Lighthouse meet GitHub Actions</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/03/06/swashbuckle-inheritance-multiple-return-types">Swashbuckle &amp; inheritance: Give. Me. The. Types</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/02/08/azure-static-web-apps-a-netlify-alternative">Azure Static Web Apps - a Netlify alternative</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;tokens&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">February 16, 2021</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><meta itemprop="image" content="https://blog.johnnyreilly.com/assets/images/easy-auth-zero-downtime-deployment-bc37a60d24030b3ad3616938515a990c.png"><div class="markdown" itemprop="articleBody"><p>I <a href="/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">wrote recently about zero downtime deployments on Azure App Service</a>. Many applications require authentication, and ours is no exception. In our case we&#x27;re using Azure Active Directory facilitated by <a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization" target="_blank" rel="noopener noreferrer">&quot;Easy Auth&quot;</a> which provides authentication to our App Service.</p><p>Our app uses a Linux App Service. It&#x27;s worth knowing that Linux App Services run as a Docker container. As a consequence, Easy Auth works in a slightly different way; effectively as a middleware. <a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization#on-containers" target="_blank" rel="noopener noreferrer">To quote the docs on Easy Auth</a>:</p><blockquote><p>This module handles several things for your app:</p><ul><li>Authenticates users with the specified provider</li><li>Validates, stores, and refreshes tokens</li><li>Manages the authenticated session</li><li>Injects identity information into request headers The module runs separately from your application code and is configured using app settings. No SDKs, specific languages, or changes to your application code are required.</li></ul><p>The authentication and authorization module runs in a separate container, isolated from your application code. Using what&#x27;s known as the <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador" target="_blank" rel="noopener noreferrer">Ambassador</a> pattern, it interacts with the incoming traffic to perform similar functionality as on Windows.</p></blockquote><p>However, <a href="https://social.msdn.microsoft.com/Forums/en-US/dde551b2-c86d-474b-b0a6-cc66163785a1/restarting-azure-app-service-on-linux-with-azure-active-directory-authentication-resets-authme#b59951ab-623a-4442-a221-80c157387bbe" target="_blank" rel="noopener noreferrer">Microsoft have acknowledged there is a potential bug in Easy Auth support at present</a>. When the app service is restarted, the stored tokens are removed, and <strong>authentication begins to fail</strong>. As you might well imagine, authentication similarly starts to fail when a new app service is introduced - as is the case during deployment.</p><p>This is really significant. You may well have &quot;zero downtime deployment&quot;, but it doesn&#x27;t amount to a hill of beans if the moment you&#x27;ve deployed your users find they&#x27;re effectively logged out. <a href="https://social.msdn.microsoft.com/Forums/en-US/dde551b2-c86d-474b-b0a6-cc66163785a1/restarting-azure-app-service-on-linux-with-azure-active-directory-authentication-resets-authme#b59951ab-623a-4442-a221-80c157387bbe" target="_blank" rel="noopener noreferrer">The advice from Microsoft</a> is to use <a href="https://docs.microsoft.com/en-gb/archive/blogs/jpsanders/azure-app-service-authentication-using-a-blob-storage-for-token-cache" target="_blank" rel="noopener noreferrer">Blob Storage for Token Cache</a>:</p><p><a href="https://twitter.com/cgillum" target="_blank" rel="noopener noreferrer">Chris Gillum</a> said in a <a href="https://cgillum.tech/2016/03/07/app-service-token-store/" target="_blank" rel="noopener noreferrer">blog on the topic</a>:</p><blockquote><p>you can provision an Azure Blob Storage container and configure your web app with a SaS URL (with read/write/list access) pointing to that blob container. This SaS URL can then be saved to the <code>WEBSITE_AUTH_TOKEN_CONTAINER_SASURL</code> app setting. When this app setting is present, all tokens will be stored in and fetched from the specified blob container.</p></blockquote><p>To turn that into something visual, what&#x27;s suggested is this:</p><p><img loading="lazy" alt="diagram of Easy Auth with blog storage" src="/assets/images/easy-auth-zero-downtime-deployment-bc37a60d24030b3ad3616938515a990c.png" width="474" height="600" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="sas-sy-arm-templates">SaS-sy ARM Templates<a class="hash-link" href="#sas-sy-arm-templates" title="Direct link to heading">​</a></h2><p>I have the good fortune to work with some very talented people. One of them, <a href="https://github.com/jmccor99" target="_blank" rel="noopener noreferrer">John McCormick</a> turned his hand to putting this proposed solution into <code>azure-pipelines.yml</code> and ARM template-land. First of all, let&#x27;s look at our <code>azure-pipelines.yml</code>. We add the following, prior to our deployment job:</p><div class="codeBlockContainer_I0IT language-yml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#d6deeb;background-color:#011627"><pre tabindex="0" class="prism-code language-yml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> SASGen</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Generate SAS Token</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> AzurePowerShell@4</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ObtainSasTokenTask</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">azureSubscription</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(serviceConnection)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">ScriptType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> inlineScript</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">Inline</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(173, 219, 103)"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                $startTime = Get-Date</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                $expiryTime = $startTime.AddDays(90)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                $storageAcc = Get-AzStorageAccount -ResourceGroupName $(azureResourceGroup) -Name $(storageAccountName)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                $ctx = $storageAcc.Context</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                $sas = New-AzStorageContainerSASToken -Context $ctx -Name &quot;tokens&quot; -Permission &quot;rwl&quot; -Protocol HttpsOnly -StartTime $startTime -ExpiryTime $expiryTime -FullUri</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                Write-Host &quot;##vso[task.setvariable variable=sasToken;issecret=true;isOutput=true]$sas&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">azurePowerShellVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;LatestVersion&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> DeployAppARMTemplates</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">variables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token key atrule">sasToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">dependencies.SASGen.outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ObtainSasTokenTask.sasToken&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deploy App ARM Templates</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">dependsOn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> SASGen</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> AzureResourceManagerTemplateDeployment@3</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deploy app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">service ARM Template</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">deploymentScope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Resource Group</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">azureResourceManagerConnection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(serviceConnection)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">subscriptionId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(subscriptionId)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">action</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Create Or Update Resource Group</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">resourceGroupName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(azureResourceGroup)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(location)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">templateLocation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Linked artifact</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">csmFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;infra/app-service/azuredeploy.json&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">csmParametersFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;infra/azuredeploy.parameters.json&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">overrideParameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">sasUrl $(sasToken)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              </span><span class="token key atrule">deploymentMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Incremental</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>There&#x27;s two notable things happening above:</p><ol><li>In the <code>SASGen</code> job, a PowerShell script runs that <a href="https://docs.microsoft.com/en-us/powershell/module/az.storage/new-azstoragecontainersastoken?view=azps-5.5.0" target="_blank" rel="noopener noreferrer">generates a SaS token URL</a> with read, write and list permissions that will last for 90 days. (Incidentally, there is a way to do this via <a href="https://stackoverflow.com/a/56127006/761388" target="_blank" rel="noopener noreferrer">ARM templates, and without PowerShell</a> <!-- -->-<!-- --> but alas it didn&#x27;t seem to work when we experimented with it.)</li><li>The generated (secret) token URL (<code>sasUrl</code>) is passed as a parameter to our App Service ARM template. The ARM template sets an appsetting for the app service:</li></ol><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#d6deeb;background-color:#011627"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;apiVersion&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2020-09-01&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;appsettings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;type&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;config&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;properties&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;WEBSITE_AUTH_TOKEN_CONTAINER_SASURL&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;[parameters(&#x27;sasUrl&#x27;)]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>If you google <code>WEBSITE_AUTH_TOKEN_CONTAINER_SASURL</code> you will not find a geat deal. Documentation is short. What you will find is <a href="http://jsandersblog.azurewebsites.net/2017/08/10/azure-app-service-authentication-using-a-blob-storage-for-token-cache/" target="_blank" rel="noopener noreferrer">Jeff Sanders excellent blog on the topic</a>. It is, in terms of content, it has some commonality with this post; except in Jeff&#x27;s example he&#x27;s manually implementing the workaround in the Azure Portal.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="whats-actually-happening">What&#x27;s actually happening?<a class="hash-link" href="#whats-actually-happening" title="Direct link to heading">​</a></h2><p>With this in place, every time someone logs into your app a JSON token is written to the storage like so:</p><p><img loading="lazy" alt="token in storage account" src="data:image/png;base64,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" width="600" height="125" class="img_E7b_"></p><p>If you take the trouble to look inside you&#x27;ll find something like this tucked away:</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#d6deeb;background-color:#011627"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;encrypted&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;tokens&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;aad&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;herewith_a_very_very_long_encrypted_token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;version&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>With this in place, you can safely restart your app service and / or deploy a new one, safe in the knowledge that the tokens will live on in the storage account, and that consequently you will not be unauthenticating users.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">Azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/easy-auth">Easy Auth</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/tokens">tokens</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/sas">SAS</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/blob-storage">Blob Storage</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Making Easy Auth tokens survive releases on Linux Azure App Service" href="/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" rel="noopener" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" loading="lazy" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.307037d0.js"></script>
<script src="/assets/js/main.72483867.js"></script>
</body>
</html>