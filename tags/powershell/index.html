<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">4 posts tagged with &quot;powershell&quot; | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="4 posts tagged with &quot;powershell&quot; | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/tags/powershell"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" name="robots" content="max-image-preview:large"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/powershell"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/powershell" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/powershell" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4905e155.css">
<link rel="preload" href="/assets/js/runtime~main.8e1e2ac7.js" as="script">
<link rel="preload" href="/assets/js/main.6ad31ac0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/19/azure-container-apps-bicep-and-github-actions">Azure Container Apps, Bicep and GitHub Actions</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/12/open-graph-sharing-previews-guide">Open Graph: a guide to sharable social media previews</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/05/azure-static-web-app-deploy-previews-with-azure-devops">Azure Static Web App Deploy Previews with Azure DevOps</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/22/typescript-vs-jsdoc-javascript">TypeScript vs JSDoc JavaScript</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/18/azure-standard-tests-with-bicep">Azure standard availability tests with Bicep</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>4 posts tagged with &quot;powershell&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2017/04/25/setting-build-version-using-appveyor">Setting Build Version Using AppVeyor and ASP.Net Core</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2017-04-25T00:00:00.000Z" itemprop="datePublished">April 25, 2017</time> Â· <!-- -->2 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>AppVeyor has <a href="https://www.appveyor.com/docs/build-configuration/#assemblyinfo-patching" target="_blank" rel="noopener noreferrer">support for setting the version of a binary during a build</a>. However - this deals with the classic ASP.Net world of <code>AssemblyInfo</code>. I didn&#x27;t find any reference to support for doing the same with dot net core. Remember, dot net core <a href="https://docs.microsoft.com/en-us/dotnet/articles/core/tools/project-json-to-csproj#version" target="_blank" rel="noopener noreferrer">relies upon a <code>&amp;lt;Version&amp;gt;</code> or a <code>&amp;lt;VersionPrefix&amp;gt;</code> setting in the <code>.csproj</code> file</a>. Personally, <code>&amp;lt;Version&amp;gt;</code> is my jam.</p><p>However, coming up with your own bit of powershell that stamps the version during the build is a doddle; here we go:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ps"><pre tabindex="0" class="prism-code language-ps codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">Param($projectFile, $buildNum)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$content = [IO.File]::ReadAllText($projectFile)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$regex = new-object System.Text.RegularExpressions.Regex (&#x27;(&lt;version&gt;)([\d]+.[\d]+.[\d]+)(.[\d]+)(&lt;\/Version&gt;)&#x27;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">         [System.Text.RegularExpressions.RegexOptions]::MultiLine)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$version = $null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$match = $regex.Match($content)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">if($match.Success) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    # from &quot;&lt;version&gt;1.0.0.0&lt;/version&gt;&quot; this will extract &quot;1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    $version = $match.groups[2].value</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># suffix build number onto $version. eg &quot;1.0.0.15&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$version = &quot;$version.$buildNum&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># update &quot;&lt;version&gt;1.0.0.0&lt;/version&gt;&quot; to &quot;&lt;version&gt;$version&lt;/version&gt;&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$content = $regex.Replace($content, &#x27;${1}&#x27; + $version + &#x27;${4}&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># update csproj file</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">[IO.File]::WriteAllText($projectFile, $content)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># update AppVeyor build</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Update-AppveyorBuild -Version $version</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/version&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can invoke this script as part of the build process in AppVeyor by adding something like this to your <code>appveyor.yml</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token key atrule">before_build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">ps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> .\ModifyVersion.ps1 $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">APPVEYOR_BUILD_FOLDER\src\Proverb.Web\Proverb.Web.csproj $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">APPVEYOR_BUILD_NUMBER</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It will keep the first 3 parts of the version in your <code>.csproj</code> (eg &quot;1.0.0&quot;) and suffix on the build number supplied by AppVeyor.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/powershell">powershell</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/version">Version</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/dot-net-core">dot net core</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/app-veyor">AppVeyor</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Setting Build Version Using AppVeyor and ASP.Net Core" href="/2017/04/25/setting-build-version-using-appveyor"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2016/03/04/tfs-2012-meet-powershell-karma-and-buildnumber">TFS 2012 meet PowerShell, Karma and BuildNumber</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2016-03-04T00:00:00.000Z" itemprop="datePublished">March 4, 2016</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>To my lasting regret, TFS 2012 has no direct support for PowerShell. Such a shame as PowerShell scripts can do a lot of heavy lifting in a build process. Well, here we&#x27;re going to brute force TFS 2012 into running PowerShell scripts. And along the way we&#x27;ll also get Karma test results publishing into TFS 2012 as an example usage. Nice huh? Let&#x27;s go!</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="powershell-via-csproj">PowerShell via <code>csproj</code><a aria-hidden="true" class="hash-link" href="#powershell-via-csproj" title="Direct link to heading">â€‹</a></h2><p>It&#x27;s time to hack the <code>csproj</code> (or whatever project file you have) again. We&#x27;re going to add an <code>AfterBuild</code> target to the end of the file. This target will be triggered after the build completes (as the name suggests):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Target</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">AfterBuild</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Message</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Importance</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">High</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Text</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">AfterBuild: PublishUrl = $(PublishUrl), BuildUri = $(BuildUri), Configuration = $(Configuration), ProjectDir = $(ProjectDir), TargetDir = $(TargetDir), TargetFileName = $(TargetFileName), BuildNumber = $(BuildNumber), BuildDefinitionName = $(BuildDefinitionName)</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">Exec</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">Command</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">powershell.exe -NonInteractive -ExecutionPolicy RemoteSigned </span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&amp;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(ProjectDir)AfterBuild.ps1&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(Configuration)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(ProjectDir)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(TargetDir)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(PublishUrl)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(BuildNumber)&#x27;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">&#x27;$(BuildDefinitionName)&#x27;&quot;&quot;</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">Target</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There&#x27;s 2 things happening in this target:</p><ol><li>A message is printed out during compilation which contains details of the various compile time variables. This is nothing more than a <code>console.log</code> statement really; it&#x27;s useful for debugging and so I keep it around. You&#x27;ll notice one of them is called <code>$(BuildNumber)</code>; more on that later.</li><li>A command is executed; PowerShell! This invokes PowerShell with the <code>-NonInteractive</code> and <code>-ExecutionPolicy RemoteSigned</code> flags. It passes a script to be executed called <code>AfterBuild.ps1</code> that lives in the root of the project directory. To that script a number of parameters are supplied; compile time variables that we may use in the script.</li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="wheres-my-buildnumber-and-builddefinitionname">Where&#x27;s my <code>BuildNumber</code> and <code>BuildDefinitionName</code>?<a aria-hidden="true" class="hash-link" href="#wheres-my-buildnumber-and-builddefinitionname" title="Direct link to heading">â€‹</a></h2><p>So you&#x27;ve checked in your changes and kicked off a build on the server. You&#x27;re picking over the log messages and you&#x27;re thinking: &quot;Where&#x27;s my <code>BuildNumber</code>?&quot;. Well, TFS 2012 does not have that set as a variable at compile time by default. This stumped me for a while but thankfully I wasn&#x27;t the only person wondering... As ever, <a href="http://stackoverflow.com/a/7330453/761388" target="_blank" rel="noopener noreferrer">Stack Overflow had the answer</a>. So, deep breath, it&#x27;s time to hack the TFS build template file.</p><p>Checkout the <code>DefaultTemplate.11.1.xaml</code> file from TFS and open it in your text editor of choice. It&#x27;s <em>find and replace</em> time! (There are probably 2 instances that need replacement.) Perform a <em>find</em> for the below</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And <em>replace</em> it with this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/p:SkipInvalidConfigurations=true /p:BuildNumber={1} /p:BuildDefinitionName={2} {0}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Pretty long line eh? Let&#x27;s try breaking that up to make it more readable: (but remember in the XAML it needs to be a one liner)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">BuildNumber</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token maybe-class-name">BuildDefinitionName</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We&#x27;re just adding 2 extra parameters of <code>BuildNumber</code> and <code>BuildDefinitionName</code> to the invocation of MSBuild. Once we&#x27;ve checked this back in, <code>BuildNumber</code> and <code>BuildDefinitionName</code> will be available on future builds. Yay! <em>Important! You must have a build name that does not feature spaces; probably there&#x27;s a way to pass spaces here but I&#x27;m not sure what it is.</em></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="afterbuildps1"><code>AfterBuild.ps1</code><a aria-hidden="true" class="hash-link" href="#afterbuildps1" title="Direct link to heading">â€‹</a></h2><p>You can use your <code>AfterBuild.ps1</code> script to do any number of things. In my case I&#x27;m going to use MSTest to publish some test results which have been generated by Karma into TFS:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ps"><pre tabindex="0" class="prism-code language-ps codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">param ([string]$configuration, [string]$projectDir, [string]$targetDir, [string]$publishUrl, [string]$buildNumber, [string] $buildDefinitionName)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$ErrorActionPreference = &#x27;Stop&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Clear</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function PublishTestResults([string]$resultsFile) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &#x27;PublishTests&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $mstest = &#x27;C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &quot;Using $mstest at $pwd&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host &quot;Publishing: $resultsFile&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> &amp; $mstest /publishresultsfile:$resultsFile /publish:http://my-tfs-server:8080/tfs /teamproject:MyProject /publishbuild:$buildNumber /platform:&#x27;Any CPU&#x27; /flavor:Release</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function FailBuildIfThereAreTestFailures([string]$resultsFile) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $results = [xml](GC $resultsFile)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $outcome = $results.TestRun.ResultSummary.outcome</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $fgColor = if($outcome -eq &quot;Failed&quot;) { &quot;Red&quot; } else { &quot;Green&quot; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $total = $results.TestRun.ResultSummary.Counters.total</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $passed = $results.TestRun.ResultSummary.Counters.passed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failed = $results.TestRun.ResultSummary.Counters.failed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failedTests = $results.TestRun.Results.UnitTestResult | Where-Object { $_.outcome -eq &quot;Failed&quot; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Test Results: $outcome -ForegroundColor $fgColor -BackgroundColor &quot;Black&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Total tests: $total</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Passed: $passed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host Failed: $failed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> $failedTests | % { Write-Host Failed test: $_.testName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host $_.Output.ErrorInfo.Message</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host $_.Output.ErrorInfo.StackTrace }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Write-Host</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> if($outcome -eq &quot;Failed&quot;) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host &quot;Failing build as there are broken tests&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  $host.SetShouldExit(1)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">function Run() {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Write-Host &quot;Running AfterBuild.ps1 using Configuration: $configuration, projectDir: $projectDir, targetDir: $targetDir, publishUrl: $publishUrl, buildNumber: $buildNumber, buildDefinitionName: $buildDefinitionName&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> if($buildNumber) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  $resultsFile = &quot;$projectDir\test-results.trx&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  PublishTestResults $resultsFile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  FailBuildIfThereAreTestFailures $resultsFile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Off we go...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Assuming we have a build number this script kicks off the <code>PublishTestResults</code> function above. So we won&#x27;t attempt to publish test results when compiling in Visual Studio on our dev machine. The script looks for <code>MSTest.exe</code> in a certain location on disk (the default VS 2015 installation location in fact; it may be installed elsewhere on your build machine). MSTest is then invoked and passed a file called <code>test-results.trx</code> which is is expected to live in the root of the project. All being well, the test results will be registered with the running build and will be visible when you look at test results in TFS.</p><p>Finally in <code>FailBuildIfThereAreTestFailures</code> we parse the <code>test-results.trx</code> file (and for this I&#x27;m totally in the debt of <a href="https://gist.github.com/davidroberts63/5655441" target="_blank" rel="noopener noreferrer">David Robert&#x27;s helpful Gist</a>). We write out the results to the host so it&#x27;ll show up in the MSBuild logs. Also, and this is crucial, if there are any failures we fail the build by exiting PowerShell with a code of 1. We are deliberately swallowing any error that Karma raises earlier when it detects failed tests. We do this because we want to publish the failed test results to TFS <em>before</em> we kill the build.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="bonus-karma-test-resultstrx">Bonus Karma: <code>test-results.trx</code><a aria-hidden="true" class="hash-link" href="#bonus-karma-test-resultstrx" title="Direct link to heading">â€‹</a></h2><p>If you&#x27;ve read a <a href="https://blog.johnnyreilly.com/2016/02/visual-studio-tsconfigjson-and-external.html" target="_blank" rel="noopener noreferrer">previous post of mine</a> you&#x27;ll be aware that it&#x27;s possible to get MSBuild to kick off npm build tasks. Specifically I have MSBuild kicking off an <code>npm run build</code>. My <code>package.json</code> looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token property" style="color:rgb(128, 203, 196)">&quot;scripts&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;test&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;karma start --reporters mocha,trx --single-run --browsers PhantomJS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;clean&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp delete-dist-contents&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;watch&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp watch&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;build&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;gulp build&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;postbuild&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;npm run test&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see that the <code>postbuild</code> hook kicks off the <code>test</code> script in turn. And that <code>test</code> script kicks off a single run of karma. I&#x27;m not going to go over setting up Karma at all here; there are other posts out there that cover that admirably. But I wanted to share news of the <a href="https://www.npmjs.com/package/karma-trx-reporter" target="_blank" rel="noopener noreferrer">karma trx reporter</a>. This reporter is the thing that produces our <code>test-results.trx</code> file; trx being the format that TFS likes to deal with.</p><p>So now we&#x27;ve got a PowerShell hook into our build process (something very useful in itself) which we are using to publish Karma test results into TFS 2012. They said it couldn&#x27;t be done. They were wrong. Huzzah!!!!!!!</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/build-definition-name">BuildDefinitionName</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/build-number">BuildNumber</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/npm">npm</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/karma">Karma</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/powershell">powershell</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/trx">trx</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/tfs-2012">TFS 2012</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about TFS 2012 meet PowerShell, Karma and BuildNumber" href="/2016/03/04/tfs-2012-meet-powershell-karma-and-buildnumber"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2015/01/07/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-2">Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 2</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2015-01-07T00:00:00.000Z" itemprop="datePublished">January 7, 2015</time> Â· <!-- -->5 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>&quot;Automation, automation, automation.&quot; Those were and are Tony Blair&#x27;s priorities for keeping open source projects well maintained.</p><p>OK, that&#x27;s not quite true... But what is certainly true is that maintaining an open source project takes time. And there&#x27;s only so much free time that anyone has. For that reason, wherever you can it makes sense to <em>AUTOMATE</em>!</p><p><a href="https://blog.johnnyreilly.com/2014/12/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-1.html" target="_blank" rel="noopener noreferrer">Last time</a> we looked at how you can take an essentially static ASP.Net MVC site (in this case my jVUNDemo documentation site) and generate an entirely static version using Wget. This static site has been pushed to <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a> and is serving as the documentation for <a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/" target="_blank" rel="noopener noreferrer">jQuery Validation Unobtrusive Native</a> (and for bonus points is costing me no money at all).</p><p>So what next? Well, automation clearly! If I make a change to jQuery Validation Unobtrusive Native then AppVeyor already bounds in and performs a <a href="https://ci.appveyor.com/project/JohnReilly/jquery-validation-unobtrusive-native" target="_blank" rel="noopener noreferrer">continuous integration build</a> for me. It picks up the <a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank" rel="noopener noreferrer">latest source</a> from GitHub, pulls in my dependencies, performs a build and runs my tests. Lovely.</p><p>So the obvious thing to do is to take this process and plug in the generation of my static site and the publication thereof to GitHub pages. The minute a change is made to my project the documentation should be updated without me having to break sweat. That&#x27;s the goal.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="github-personal-access-token">GitHub Personal Access Token<a aria-hidden="true" class="hash-link" href="#github-personal-access-token" title="Direct link to heading">â€‹</a></h2><p>In order to complete our chosen mission we&#x27;re going to need a GitHub Personal Access Token. We&#x27;re going to use it when we clone, update and push our GitHub Pages branch. To get one we biff over to Settings / Applications in GitHub and click the &quot;Generate New Token&quot; button.</p><p><img src="/assets/images/GitHubApplicationSettings-0790b82d8871591693e5e863d009478f.png"></p><p>The token I&#x27;m using for my project has the following scopes selected:</p><p><img src="/assets/images/GitHub%2BPersonal%2BAccess%2BToken-c442c5f2b2e6435d9a885d4524641084.png"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="appveyoryml"><code>appveyor.yml</code><a aria-hidden="true" class="hash-link" href="#appveyoryml" title="Direct link to heading">â€‹</a></h2><p>With our token in hand we turn our attention to AppVeyor build configuration. This is possible using a file called <a href="http://www.appveyor.com/docs/build-configuration" target="_blank" rel="noopener noreferrer"><code>appveyor.yml</code></a> stored in the root of your repo. You can also use the AppVeyor web UI to do this. However, for the purposes of ease of demonstration I&#x27;m using the file approach. The <a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/appveyor.yml" target="_blank" rel="noopener noreferrer">jQuery Validation Unobtrusive Native <code>appveyor.yml</code></a> looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#---------------------------------#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#      general configuration      #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#---------------------------------#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># version format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 1.0.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#---------------------------------#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#    environment configuration    #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#---------------------------------#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># environment variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">GithubEmail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> johnny_reilly@hotmail.com</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">GithubUsername</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> johnnyreilly</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">GithubPersonalAccessToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">secure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> T4M/N+e/baksVoeWoYKPWIpfahOsiSFw/+Zc81VuThZmWEqmrRtgEHUyin0vCWhl</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">branches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">only</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">install</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">ps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choco install wget</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">verbosity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> minimal</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">after_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">ps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./makeStatic.ps1 $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">APPVEYOR_BUILD_FOLDER</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">ps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./pushStatic.ps1 $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">APPVEYOR_BUILD_FOLDER $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">GithubEmail $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">GithubUsername $env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">GithubPersonalAccessToken</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There&#x27;s a number of things you should notice from the yml file:</p><ul><li>We create 3 environment variables: GithubEmail, GithubUsername and GithubPersonalAccessToken (more on this in a moment).</li><li>We only build the master branch.</li><li>We use <a href="https://chocolatey.org/packages/Wget" target="_blank" rel="noopener noreferrer">Chocolatey</a> to install Wget which is used by the <code>makeStatic.ps1</code> Powershell script.</li><li>After the tests have completed we run 2 Powershell scripts. First <code>&lt;a href=&quot;https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/makeStatic.ps1&quot;&gt;makeStatic.ps1&lt;/a&gt;</code> which builds the static version of our site. This is the exact same script we discussed in the previous post - we&#x27;re just passing it the build folder this time (one of AppVeyor&#x27;s environment variables). Second, we run <code>&lt;a href=&quot;https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/pushStatic.ps1&quot;&gt;pushStatic.ps1&lt;/a&gt;</code> which publishes the static site to GitHub Pages.</li></ul><p>We pass 4 arguments to <code>pushStatic.ps1</code>: the build folder, my email address, my username and my personal access token. For the sake of security the GithubPersonalAccessToken has been encrypted as indicated by the <code>secure</code> keyword. This is a capability available in AppVeyor <a href="https://ci.appveyor.com/tools/encrypt" target="_blank" rel="noopener noreferrer">here</a>.</p><p><img src="/assets/images/AppVeyor%2Bencrypt-3af61b9bc54886ffb7a28c16788ccb3e.png"></p><p>This allows me to mask my personal access token rather than have it available as free text for anyone to grab.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="pushstaticps1"><code>pushStatic.ps1</code><a aria-hidden="true" class="hash-link" href="#pushstaticps1" title="Direct link to heading">â€‹</a></h2><p>Finally we can turn our attention to how our Powershell script <code>pushStatic.ps1</code> goes about pushing our changes up to GitHub Pages:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ps"><pre tabindex="0" class="prism-code language-ps codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">param([string]$buildFolder, [string]$email, [string]$username, [string]$personalAccessToken)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Write-Host &quot;- Set config settings....&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git config --global user.email $email</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git config --global user.name $username</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git config --global push.default matching</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Write-Host &quot;- Clone gh-pages branch....&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cd &quot;$($buildFolder)\..\&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">mkdir gh-pages</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone --quiet --branch=gh-pages https://$($username):$($personalAccessToken)@github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native.git .\gh-pages\</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cd gh-pages</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Write-Host &quot;- Clean gh-pages folder....&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Get-ChildItem -Attributes !r | Remove-Item -Recurse -Force</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Write-Host &quot;- Copy contents of static-site folder into gh-pages folder....&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">copy-item -path ..\static-site\* -Destination $pwd.Path -Recurse</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$thereAreChanges = git status | select-string -pattern &quot;Changes not staged for commit:&quot;,&quot;Untracked files:&quot; -simplematch</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">if ($thereAreChanges -ne $null) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Write-host &quot;- Committing changes to documentation...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    git add --all</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    git status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    git commit -m &quot;skip ci - static site regeneration&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    git status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Write-Host &quot;- Push it....&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    git push --quiet</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Write-Host &quot;- Pushed it good!&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">else {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    write-host &quot;- No changes to documentation to commit&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>So what&#x27;s happening here? Let&#x27;s break it down:</p><ul><li>Git is configured with the passed in username and email address.</li><li>A folder is created that sits alongside the build folder called &quot;gh-pages&quot;.</li><li>We clone the &quot;gh-pages&quot; branch of jQuery Validation Unobtrusive Native into our &quot;gh-pages&quot; directory. You&#x27;ll notice that we are using our GitHub personal access token in the clone URL itself.</li><li>We delete the contents of the &quot;gh-pages&quot; directory leaving it empty.</li><li>We copy across the contents of the &quot;static-site&quot; folder (created by <code>makeStatic.ps1</code>) into the &quot;gh-pages&quot;.</li><li>We use <code>git status</code> to check if there are any changes. (This method is completely effective but a little crude to my mind - there&#x27;s probably better approaches to this.... shout me in the comments if you have a suggestion.)</li><li>If we have no changes then we do nothing.</li><li>If we have changes then we stage them, commit them and push them to GitHub Pages. Then we sign off with an allusion to <a href="https://en.wikipedia.org/wiki/Push_It_(Salt-n-Pepa_song)" target="_blank" rel="noopener noreferrer">80&#x27;s East Coast hip-hop</a>... &#x27;Cos that&#x27;s how we roll.</li></ul><p>With this in place, any changes to the docs will be automatically published out to our &quot;gh-pages&quot; branch. Our documentation will always be up to date thanks to the goodness of AppVeyor&#x27;s Continuous Integration service.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/git-hub-personal-access-token">GitHub Personal Access Token</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/continuous-integration">Continuous Integration</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/powershell">powershell</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/github-pages">github pages</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/app-veyor">AppVeyor</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 2" href="/2015/01/07/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-2"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2014/12/29/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-1">Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 1</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2014-12-29T00:00:00.000Z" itemprop="datePublished">December 29, 2014</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>There&#x27;s a small open source project I&#x27;m responsible for called <a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank" rel="noopener noreferrer">jQuery Validation Unobtrusive Native</a>. (A catchy name is a must for any good open source project. Alas I&#x27;m not quite meeting my own exacting standards on this particular point... I should have gone with my gut and called it &quot;Livingstone&quot; instead. Too late now...)</p><p>The project itself is fairly simple in purpose. It&#x27;s essentially a bridge between ASP.Net MVC&#x27;s inbuilt support for driving validation from data attributes and jQuery Validation&#x27;s native support for the same. It is, in the end, a collection of ASP.Net MVC HTML helper extensions. It is not massively complicated.</p><p>I believe it was Tony Blair that said &quot;documentation, documentation, documentation&quot; were his priorities for open source projects. Or maybe it was someone else... Anyway, the point stands. Documentation is supremely important if you want your project to be in any way useful to anyone other than yourself. A project, no matter how fantastic, which lacks decent documentation is a missed opportunity.</p><p>Anyway I&#x27;m happy to say that jQuery Validation Unobtrusive Native <em>has</em> documentation! And pretty good documentation at that. The documentation takes the form of the <a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/tree/master/jVUNDemo" target="_blank" rel="noopener noreferrer">jVUNDemo</a> project which is part of the jQuery Validation Unobtrusive Native repo. jVUNDemo is an ASP.Net MVC web application which is built on top of the jQuery Validation Unobtrusive Native helpers. It demonstrates the helpers in action and documents how you might go about using them. It looks a bit like this:</p><p><img src="/assets/images/Screenshot%2B2014-12-29%2B06.22.46-d3f12870d1baaae368591cf3cfbbf9a0.png"></p><p>When I first put jVUNDemo together I hosted it on Azure so the world could see it in all it&#x27;s finery. And that worked just fine. However, there&#x27;s something you ought to know about me:</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="im-quite-cheap">I&#x27;m quite cheap<a aria-hidden="true" class="hash-link" href="#im-quite-cheap" title="Direct link to heading">â€‹</a></h2><p>No really, I am. My attention was grabbed by the essentially &quot;free&quot; nature of <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. I was immediately seized by the desire to somehow deploy jVUNDemo to GitHub Pages and roll around joyfully in all that lovely free hosting.</p><p>&quot;But&quot;, I hear you cry, &quot;you can&#x27;t deploy an ASP.Net MVC application to Git Hub Pages... It only hosts static sites!&quot; Quite right. Sort of. This is where I get to pull my ace of spades: jVUNDemo is not really an &quot;app&quot; so much as a static site. Yup, once the HTML that makes up each page is generated there isn&#x27;t any app like business to do. It&#x27;s just a collection of text and 1 screen demo&#x27;s really.</p><p>That being the case, there&#x27;s no reason why I shouldn&#x27;t be able to make use of GitHub Pages. So that&#x27;s what I decided to do. Whilst I was at it I also wanted to automate the deployment process. When I tweak jVUNDemo I don&#x27;t want to have to manually push out a new version of jVUNDemo to wherever it&#x27;s being hosted. No, I&#x27;m a developer so I&#x27;ll automate it.</p><p>I&#x27;ve broken this up into 2 posts. This first one will cover how you generate a static site from an ASP.Net MVC site. The second will be about how to use <a href="http://www.appveyor.com/" target="_blank" rel="noopener noreferrer">AppVeyor</a> to ensure that on each build your documentation is getting republished.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="you-wget-me">You Wget me?<a aria-hidden="true" class="hash-link" href="#you-wget-me" title="Direct link to heading">â€‹</a></h2><p>So, static site generation. There&#x27;s a well known Unix utility called <a href="https://en.wikipedia.org/wiki/Wget" target="_blank" rel="noopener noreferrer">Wget</a> which covers exactly that ground and so we&#x27;re going to use it. It downloads and saves HTML, it recursively walks the links inside the site and grabs those pages too and it converts our routes so they are locally browsable (&quot;Demo/Required&quot; becomes &quot;Demo/Required.html&quot;).</p><p>You can use <a href="https://chocolatey.org/packages/Wget" target="_blank" rel="noopener noreferrer">Chocolatey</a> to get a copy of Wget. We&#x27;re also going to need IIS Express to host jVUNDemo whilst Wget converts it. Once jVUNDemo has been built successfully you should be be able to kick off the process like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ps"><pre tabindex="0" class="prism-code language-ps codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">cd C:\projects\jquery-validation-unobtrusive-native</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">.\makeStatic.ps1 $pwd.path</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This invokes the <code>makeStatic</code> Powershell script in the root of the jQuery Validation Unobtrusive Native repo:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ps"><pre tabindex="0" class="prism-code language-ps codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">param([string]$buildFolder)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$jVUNDemo = &quot;$($buildFolder)\jVUNDemo&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$staticSiteParentPath = (get-item $buildFolder).Parent.FullName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$staticSite = &quot;static-site&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$staticSitePath = &quot;$($staticSiteParentPath)\$($staticSite)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$wgetLogPath = &quot;$($staticSiteParentPath)\wget.log&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$port = 57612</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$servedAt = &quot;http://localhost:$($port)/&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;jVUNDemo location: $jVUNDemo&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;static site parent location: $staticSiteParentPath&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;static site location: $staticSitePath&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;wget log path: $wgetLogPath&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;Spin up jVUNDemo site at $($servedAt)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">$process = Start-Process &#x27;C:\Program Files (x86)\IIS Express\iisexpress.exe&#x27; -NoNewWindow -ArgumentList &quot;/path:$($jVUNDemo) /port:$($port)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;Wait a moment for IIS to startup&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Start-sleep -s 15</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">if (Test-Path $staticSitePath) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    write-host &quot;Removing $($staticSitePath)...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Remove-Item -path $staticSitePath -Recurse -Force</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;Create static version of demo site here: $($staticSitePath)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Push-Location $staticSiteParentPath</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># 2&gt;&amp;1 used to combine stderr and stdout</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">wget.exe --recursive --convert-links -E --directory-prefix=$staticSite --no-host-directories $servedAt &gt; $wgetLogPath 2&gt;&amp;1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;lastExitCode: $($lastExitCode)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cat $wgetLogPath</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Pop-Location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">write-host &quot;Shut down jVUNDemo site&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">stop-process -Name iisexpress</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">if (Test-Path $staticSitePath) {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    write-host &quot;Contents of $($staticSitePath)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ls $staticSitePath</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The above Powershell does the following:</p><ol><li>Starts up IIS Express serving jVUNDemo on http://localhost:57612/</li><li>Waits 15 seconds for IIS Express to get itself together (probably a shorter wait time would be sufficient)</li><li>Points Wget at jVUNDemo and bellows &quot;go!!!!&quot;</li><li>Wget downloads and saves the static version of jVUNDemo to a directory called &quot;static-site&quot;</li><li>Stops IIS Express</li><li>Prints out the contents of the &quot;static-site&quot; directory</li></ol><p>When run, it pumps something like this out:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">jVUNDemo location: C:\projects\jquery-validation-unobtrusive-native\jVUNDemo</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">static site parent location: C:\projects</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">static site location: C:\projects\static-site</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">wget log path: C:\projects\wget.log</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Spin up jVUNDemo site at http://localhost:57612/</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Wait a moment for IIS to startup</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Create static version of demo site here: C:\projects\static-site</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">wget.exe : --2014-12-29 07:49:56--  http://localhost:57612/</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Resolving localhost...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">127.0.0.1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Connecting to localhost|127.0.0.1|:57612... connected.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">HTTP request sent, awaiting response...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">200 OK</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">..... lots of HTTP requests.....</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Downloaded: 30 files, 1.0M in 0.09s (10.8 MB/s)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/CreditCard.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Number.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Range.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Email.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/AdvancedDemo/CustomValidation.html... 35-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Date.html... 36-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Home/License.html... 27-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/index.html... 29-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/AdvancedDemo/Dynamic.html... 35-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/MaxLengthMinLength.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Required.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/AdvancedDemo.html... 32-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Remote.html... 35-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/EqualTo.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/AdvancedDemo/Globalize.html... 38-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo/Url.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Demo.html... 37-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Home/GettingStarted.html... 29-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/Home/Download.html... 27-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converting static-site/AdvancedDemo/Tooltip.html... 34-0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Converted 20 files in 0.03 seconds.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Shut down jVUNDemo site</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Contents of C:\projects\static-site</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Directory: C:\projects\static-site</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Mode                LastWriteTime     Length Name</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----                -------------     ------ ----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">d----        12/29/2014   7:50 AM            AdvancedDemo</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">d----        12/29/2014   7:50 AM            Content</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">d----        12/29/2014   7:50 AM            Demo</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">d----        12/29/2014   7:50 AM            Home</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">d----        12/29/2014   7:50 AM            Scripts</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-a---        12/29/2014   7:50 AM       5967 AdvancedDemo.html</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-a---        12/29/2014   7:50 AM       6802 Demo.html</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-a---        12/29/2014   7:47 AM      12862 favicon.ico</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-a---        12/29/2014   7:50 AM       8069 index.html</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And that&#x27;s it for part 1 my friends! You now have a static version of the ASP.Net MVC site to dazzle the world with. I should say for the purposes of full disclosure that there are 2 pages in the site which are not entirely &quot;static&quot; friendly. For these 2 pages I&#x27;ve put messages in that are displayed when the page is served up in a static format explaining the limitations. Their full glory can still be experienced by cloning the project and running locally.</p><p><a href="https://blog.johnnyreilly.com/2015/01/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-2.html" target="_blank" rel="noopener noreferrer">Next time</a> we&#x27;ll take the mechanism detailed above and plug it into AppVeyor for some Continuous Integration happiness.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/wget">wget</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/powershell">powershell</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/github-pages">github pages</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/app-veyor">AppVeyor</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 1" href="/2014/12/29/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-1"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8e1e2ac7.js"></script>
<script src="/assets/js/main.6ad31ac0.js"></script>
</body>
</html>