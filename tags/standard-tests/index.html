<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">One post tagged with &quot;standard tests&quot; | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;standard tests&quot; | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/tags/standard-tests"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" name="robots" content="max-image-preview:large"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/standard-tests"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/standard-tests" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/standard-tests" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ff16c2af.css">
<link rel="preload" href="/assets/js/runtime~main.4bb9d4be.js" as="script">
<link rel="preload" href="/assets/js/main.14ca547e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/05/azure-static-web-app-deploy-previews-with-azure-devops">Azure Static Web App Deploy Previews with Azure DevOps</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/22/typescript-vs-jsdoc-javascript">TypeScript vs JSDoc JavaScript</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/18/azure-standard-tests-with-bicep">Azure standard availability tests with Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/10/31/nswag-generated-c-sharp-client-property-name-clash">NSwag generated C# client: Open API property name clashes and decimal types rather than double</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/10/18/docusaurus-meta-tags-and-google-discover">Docusaurus, meta tags and Google Discover</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;standard tests&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2021/11/18/azure-standard-tests-with-bicep">Azure standard availability tests with Bicep</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-18T00:00:00.000Z" itemprop="datePublished">November 18, 2021</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><meta itemprop="image" content="https://blog.johnnyreilly.com/blog/2021-11-18-azure-standard-tests-with-bicep/title-image.png"><div class="markdown" itemprop="articleBody"><p>Azure standard tests are a tremendous way to monitor the uptime of your services in Azure. Sometimes also called availability tests, web tests and ping tests, this post goes through how to deploy one using Bicep. It also looks at some of the gotchas that you may encounter as you&#x27;re setting it up.</p><p><img alt="title image reading &amp;quot;Azure standard availability tests with Bicep&amp;quot; with a Bicep logo and Azure logos" src="/assets/images/title-image-f703ae98e6d7082e00e80758597026cf.png"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="what-are-standard-tests">What are standard tests?<a aria-hidden="true" class="hash-link" href="#what-are-standard-tests" title="Direct link to heading">â€‹</a></h2><p>To quote the <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/availability-standard-tests" target="_blank" rel="noopener noreferrer">docs</a>:</p><blockquote><p>Standard tests are a single request test that is similar to the URL ping test but more advanced. In addition to validating whether an endpoint is responding and measuring the performance, Standard tests also includes SSL certificate validity, proactive lifetime check, HTTP request verb (for example GET,HEAD,POST, etc.), custom headers, and custom data associated with your HTTP request.</p></blockquote><p>So we can use these to:</p><ul><li>send requests to a URL</li><li>from a variety of geographic locations</li><li>and determine if it is responding with a 200 status code</li></ul><p>The URL may be one of our own service URLs, but it could be checking any kind of URL. It&#x27;s web specific, not Azure specific.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="standard-test-bicep">Standard test Bicep<a aria-hidden="true" class="hash-link" href="#standard-test-bicep" title="Direct link to heading">â€‹</a></h2><p>Now we&#x27;re going to write a Bicep module that provisions a standard test named <code>standard-test.bicep</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><pre tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;Tags that our resources need&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param tags object</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;The resource id of the app insights which the webtest will reference&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param appInsightsResourceId string</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;The name of the webtest to create&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param standardTestName string</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;URL to test&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param urlToTest string</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;Interval in seconds between test runs for this WebTest. Default value is 300.&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param frequency int = 300</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;Seconds until this WebTest will timeout and fail. Default value is 30.&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param timeout int = 30</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">// useful reference:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">// https://docs.microsoft.com/en-us/azure/azure-monitor/app/monitor-web-app-availability#azure</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@allowed([</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-au-syd-edge&#x27; // Australiaâ€¯East</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;latam-br-gru-edge&#x27; // Brazil South</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-fl-mia-edge&#x27; // Central US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;apac-hk-hkn-azr&#x27; // East Asia</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-va-ash-azr&#x27; // East US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-ch-zrh-edge&#x27; // France South (Formerly France Central)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-fr-pra-edge&#x27; // France Central</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;apac-jp-kaw-edge&#x27; // Japan East</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-gb-db3-azr&#x27; // North Europe</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-il-ch1-azr&#x27; // North Central US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-tx-sn1-azr&#x27; // South Central US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;apac-sg-sin-azr&#x27; // Southeast Asia</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-se-sto-edge&#x27; // UK West</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-nl-ams-azr&#x27; // West Europe</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-ca-sjc-azr&#x27; // West US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-ru-msa-edge&#x27; // UK South</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">])</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;The populations (locations) for the test&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param testPopulations array = [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-se-sto-edge&#x27; // UK West</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-ru-msa-edge&#x27; // UK South</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;emea-gb-db3-azr&#x27; // North Europe</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;us-va-ash-azr&#x27; // East US</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;apac-sg-sin-azr&#x27; // Southeast Asia</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">var tagsWithHiddenLink = union({</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &#x27;hidden-link:${appInsightsResourceId}&#x27;: &#x27;Resource&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}, tags)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">resource standardWebTest &#x27;Microsoft.Insights/webtests@2018-05-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: standardTestName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  location: resourceGroup().location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  tags: tagsWithHiddenLink</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  kind: &#x27;ping&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    SyntheticMonitorId: urlToTest</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Name: urlToTest</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Description: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Enabled: true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Frequency: frequency</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Timeout: timeout</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Kind: &#x27;standard&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    RetryEnabled: true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Locations: [for testPopulation in testPopulations: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      Id: testPopulation</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Configuration: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Request: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      RequestUrl: urlToTest</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      Headers: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      HttpVerb: &#x27;GET&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      RequestBody: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ParseDependentRequests: false</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      FollowRedirects: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ValidationRules: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ExpectedHttpStatusCode: 200</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      IgnoreHttpsStatusCode: false</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ContentValidation: null</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      SSLCheck: true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      SSLCertRemainingLifetimeCheck: 7</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">output standardWebTestName string = standardWebTest.name</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">output standardWebTestId string = standardWebTest.id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="locations--populations">Locations / populations<a aria-hidden="true" class="hash-link" href="#locations--populations" title="Direct link to heading">â€‹</a></h3><p>You&#x27;ll note that a parameter to the Bicep module is <code>testPopulations</code>. These are the geographical places where requests will be sent from. You&#x27;ll note we have a default value of five populations, but these could be any of the (presently) sixteen valid values. If you were wondering where those are sourced from, <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/availability-standard-tests#location-population-tags" target="_blank" rel="noopener noreferrer">here is the link to the Azure docs</a>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="the-hidden-link-tag">The <code>hidden-link</code> tag<a aria-hidden="true" class="hash-link" href="#the-hidden-link-tag" title="Direct link to heading">â€‹</a></h3><p>Another significant call out should go to the <code>hidden-link</code> tag. The <code>hidden-link</code> tag is a mandatory tag that connects the test (known in Azure as a &quot;webtest&quot;) to an app insights instance.</p><p>If you do not provide a <code>hidden-link</code> tag, or if you try to specify a resource group other than the app insights resource group, Azure will fail to deploy your test and you may find yourself presented with an error like this in the deployments section of the Azure Portal.</p><blockquote><p>Resource should exist in the same resource group as the linked component</p></blockquote><p><img alt="screenshot of the Azure Portal Deployments section saying &amp;quot;Resource should exist in the same resource group as the linked component&amp;quot;" src="/assets/images/screenshot-azure-portal-deployments-resource-should-exist-in-the-same-resource-group-2dd50b98491bb7a0b657a9b1a266435a.png"></p><p>In our module we set both the <code>hidden-link</code> tag as well as the tags that have been supplied via the <code>tags</code> parameter.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="app-insights-and-standard-tests-share-a-resource-group">App insights and standard tests share a resource group<a aria-hidden="true" class="hash-link" href="#app-insights-and-standard-tests-share-a-resource-group" title="Direct link to heading">â€‹</a></h3><p>Another thing that can cause issues is the deployment of your app insights resource. It&#x27;s not unusual to spin up Azure resources on demand, for a given branch of your source code. Those resources will be named in relation to the branch and will depend upon one another. I&#x27;ve never managed to successfully create an app insights resource, and reference it from a standard test within the same Bicep file. It appears to be necessary to separate the two actions, such that Azure recognises the existence of the app insights resource when the standard test is deployed.</p><p>If you are working with long-lived app insights it won&#x27;t be an issue for you, but if you aren&#x27;t it&#x27;s worth being aware of.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="using-standard-testbicep">Using <code>standard-test.bicep</code><a aria-hidden="true" class="hash-link" href="#using-standard-testbicep" title="Direct link to heading">â€‹</a></h2><p>Our Bicep module can be invoked from another Bicep module named <code>ping-them.bicep</code> like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><pre tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;Tags that our resources need&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param tags object</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;The name of the app insights&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param appInsightsName string</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">@description(&#x27;An object where the keys are the name of the web test and the values are the URL eg {&quot;my-standard-test&quot;: &quot;https://status.azure.com/en-gb/status&quot;} &#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param standardTests object</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">var appInsightsResourceId = resourceId(&#x27;Microsoft.Insights/components&#x27;, appInsightsName)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">module standardTestsToCreate &#x27;standard-test.bicep&#x27; = [for standardTest in items(standardTests): {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: standardTest.key</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  params: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    tags: tags</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    appInsightsResourceId: appInsightsResourceId</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    standardTestName: standardTest.key</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    urlToTest: standardTest.value</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, this module itself takes a number of parameters, and will typically be invoked from some kind of continuous integration mechanism such as Azure Pipelines or GitHub Actions.</p><p>This module is written in the expectation that multiple URLs will need to be pinged, and so it has a parameter named <code>standardTests</code> which is effectively a dictionary of key-value pairs, where the key is the name of the standard test, and the value is the URL to test.</p><p>The module makes use of the <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/bicep-functions-array#items" target="_blank" rel="noopener noreferrer"><code>items</code></a> array helper in Bicep to convert the object into an array that can be iterated over.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="azure-pipelines-test">Azure Pipelines test<a aria-hidden="true" class="hash-link" href="#azure-pipelines-test" title="Direct link to heading">â€‹</a></h2><p>We&#x27;re going to use Azure Pipelines to test this out. Here&#x27;s an <code>azure-pipelines.yml</code> file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token key atrule">trigger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">pool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">vmImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">checkout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> self</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">submodules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">bash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> az bicep build </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">file ping</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">them.bicep</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Compile Bicep to ARM&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> AzureResourceManagerTemplateDeployment@3</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> DeploySharedWebTests</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deploy Shared Web Tests</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">deploymentScope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Resource Group</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">azureResourceManagerConnection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> variables.serviceConnection </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">subscriptionId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(subscriptionId)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">action</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Create Or Update Resource Group</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">resourceGroupName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(resourceGroup)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $(location)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">templateLocation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Linked artifact</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">csmFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ping-them.json&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># created by bash script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">overrideParameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tags </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token key atrule">&quot;owner&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;@johnny_reilly&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token key atrule">&quot;branch&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;$(Build.SourceBranchName)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">appInsightsName $(appInsightsName)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">standardTests </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token key atrule">&quot;my-standard-test&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://status.azure.com/en-gb/status&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token key atrule">deploymentMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Incremental</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When run, it invokes our <code>ping-them.bicep</code> module, passing two URLs to test.</p><p>When executed, you end up with a delightful &quot;availability test&quot; (which is your standard test) in Azure:</p><p><img alt="screenshot of an Availability test in the Azure Portal" src="/assets/images/screenshot-azure-portal-availability-e940ec4429edeb830e5f7d55e355cad4.png"></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/azure">Azure</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/bicep">Bicep</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/standard-tests">standard tests</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Azure standard availability tests with Bicep" href="/2021/11/18/azure-standard-tests-with-bicep"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4bb9d4be.js"></script>
<script src="/assets/js/main.14ca547e.js"></script>
</body>
</html>